
{% extends "base.html" %}

{% block title %}Payment Methods - Admin{% endblock %}

{% block content %}
<div class="container my-5">
    <h2 class="mb-4">Payment Methods</h2>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Add Payment Method</h5>
            <form method="POST" id="paymentMethodForm">
                {{ form.hidden_tag() }}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        {{ form.name.label(class="form-label") }}
                        {{ form.name(class="form-control") }}
                    </div>
                    <div class="col-md-6 mb-3">
                        {{ form.type.label(class="form-label") }}
                        {{ form.type(class="form-control", id="paymentType") }}
                    </div>
                </div>
                
                <!-- Crypto Fields -->
                <div id="cryptoFields" class="payment-fields" style="display:none;">
                    <h6 class="text-primary mt-3">Cryptocurrency Details</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.crypto_currency.label(class="form-label") }}
                            {{ form.crypto_currency(class="form-control") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.crypto_wallet_address.label(class="form-label") }}
                            {{ form.crypto_wallet_address(class="form-control", placeholder="Enter wallet address") }}
                        </div>
                    </div>
                </div>
                
                <!-- Bank Transfer Fields -->
                <div id="bankFields" class="payment-fields" style="display:none;">
                    <h6 class="text-primary mt-3">Bank Transfer Details</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.bank_name.label(class="form-label") }}
                            {{ form.bank_name(class="form-control", placeholder="e.g., Chase Bank") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.account_name.label(class="form-label") }}
                            {{ form.account_name(class="form-control", placeholder="Account holder name") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.account_number.label(class="form-label") }}
                            {{ form.account_number(class="form-control", placeholder="Account number") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.routing_number.label(class="form-label") }}
                            {{ form.routing_number(class="form-control", placeholder="Routing/SWIFT code") }}
                        </div>
                        <div class="col-12 mb-3">
                            {{ form.bank_address.label(class="form-label") }}
                            {{ form.bank_address(class="form-control", rows=2, placeholder="Bank branch address") }}
                        </div>
                    </div>
                </div>
                
                <!-- PayPal Fields -->
                <div id="paypalFields" class="payment-fields" style="display:none;">
                    <h6 class="text-primary mt-3">PayPal Configuration</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.paypal_client_id.label(class="form-label") }}
                            {{ form.paypal_client_id(class="form-control", placeholder="PayPal Client ID") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.paypal_secret.label(class="form-label") }}
                            {{ form.paypal_secret(class="form-control", placeholder="PayPal Secret Key") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.paypal_mode.label(class="form-label") }}
                            {{ form.paypal_mode(class="form-control") }}
                        </div>
                    </div>
                </div>
                
                <!-- Paystack Fields -->
                <div id="paystackFields" class="payment-fields" style="display:none;">
                    <h6 class="text-primary mt-3">Paystack Configuration</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.paystack_public_key.label(class="form-label") }}
                            {{ form.paystack_public_key(class="form-control", placeholder="Paystack Public Key") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.paystack_secret_key.label(class="form-label") }}
                            {{ form.paystack_secret_key(class="form-control", placeholder="Paystack Secret Key") }}
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    {{ form.details.label(class="form-label") }}
                    {{ form.details(class="form-control", rows=3, placeholder="Additional instructions for users") }}
                </div>
                {{ form.submit(class="btn btn-primary") }}
            </form>
        </div>
    </div>
    
    <h4 class="mb-3">Existing Payment Methods</h4>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Configuration</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for method in methods %}
                <tr>
                    <td>{{ method.id }}</td>
                    <td>{{ method.name }}</td>
                    <td><span class="badge bg-info">{{ method.type }}</span></td>
                    <td>
                        {% if method.type == 'crypto' %}
                            <small>{{ method.crypto_currency }}: {{ method.crypto_wallet_address[:20] }}...</small>
                        {% elif method.type == 'bank' %}
                            <small>{{ method.bank_name }} - {{ method.account_number }}</small>
                        {% elif method.type == 'paypal' %}
                            <small>Mode: {{ method.paypal_mode }}</small>
                        {% elif method.type == 'paystack' %}
                            <small>Configured</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if method.active %}
                        <span class="badge bg-success">Active</span>
                        {% else %}
                        <span class="badge bg-secondary">Inactive</span>
                        {% endif %}
                    </td>
                    <td>
                        <form method="POST" action="{{ url_for('admin.toggle_payment_method', id=method.id) }}" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-primary">Toggle</button>
                        </form>
                        <form method="POST" action="{{ url_for('admin.delete_payment_method', id=method.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure?');">
                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
document.getElementById('paymentType').addEventListener('change', function() {
    // Hide all payment fields
    document.querySelectorAll('.payment-fields').forEach(function(el) {
        el.style.display = 'none';
    });
    
    // Show relevant fields based on selection
    const type = this.value;
    if (type === 'crypto') {
        document.getElementById('cryptoFields').style.display = 'block';
    } else if (type === 'bank') {
        document.getElementById('bankFields').style.display = 'block';
    } else if (type === 'paypal') {
        document.getElementById('paypalFields').style.display = 'block';
    } else if (type === 'paystack') {
        document.getElementById('paystackFields').style.display = 'block';
    }
});

// Trigger on page load if a type is already selected
document.getElementById('paymentType').dispatchEvent(new Event('change'));
</script>
{% endblock %}
